$schema: https://azuremlschemas.azureedge.net/latest/pipelineJob.schema.json
name: AML_RAI_Analysis_Adult_VERSION_REPLACEMENT_STRING
experiment_name: AML_RAI_Adult_VERSION_REPLACEMENT_STRING
type: pipeline

inputs:
  target_column_name: income
  my_training_data:
    type: uri_file
    path: azureml:Adult_Train_PQ:VERSION_REPLACEMENT_STRING
    mode: ro_mount
  my_test_data:
    type: uri_file
    path: azureml:Adult_Test_PQ:VERSION_REPLACEMENT_STRING
    mode: ro_mount

settings:
  default_datastore: azureml:workspaceblobstore
  default_compute: azureml:cpucluster
  continue_on_step_failure: false

jobs:
  train-model-job:
    type: command
    component: azureml:TrainLogisticRegressionForRAI:VERSION_REPLACEMENT_STRING
    inputs:
      training_data: ${{parent.inputs.my_training_data}}
      target_column_name: ${{parent.inputs.target_column_name}}


  register-model-job:
    type: command
    component: azureml:RegisterModel:VERSION_REPLACEMENT_STRING
    inputs:
      model_input_path: ${{parent.jobs.train-model-job.outputs.model_output}}
      model_base_name: component_registered_lr_01

  create-rai-job:
    type: command
    component: azureml:RAIInsightsConstructor:VERSION_REPLACEMENT_STRING
    inputs:
      title: With just the OSS
      task_type: classification
      model_info_path: ${{parent.jobs.register-model-job.outputs.model_info_output_path}}
      train_dataset: ${{parent.inputs.my_training_data}}
      test_dataset: ${{parent.inputs.my_test_data}}
      target_column_name: ${{parent.inputs.target_column_name}}
      categorical_column_names: '["Race", "Sex", "Workclass", "Marital Status", "Country", "Occupation"]'